#Middleware ‚Äî —á—Ç–æ —ç—Ç–æ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –∑–∞—á–µ–º –Ω—É–∂–Ω–æ —Å–µ–Ω—å–æ—Ä–∞–º?

## 1. –í–≤–µ–¥–µ–Ω–∏–µ: Middleware –≤ –¥–≤—É—Ö —Å–ª–æ–≤–∞—Ö

**Middleware** ‚Äî —ç—Ç–æ "–ø–æ—Å—Ä–µ–¥–Ω–∏–∫" –≤ —Å–æ—Ñ—Ç–µ. –ü—Ä–æ—â–µ –≥–æ–≤–æ—Ä—è, —ç—Ç–æ –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç–æ–∏—Ç –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–æ–º –∏ –æ—Ç–≤–µ—Ç–æ–º, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—è –∏—Ö –ø–æ –ø—É—Ç–∏. –ï—Å–ª–∏ –≤—ã —Ä–∞–±–æ—Ç–∞–ª–∏ —Å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞–º–∏, –æ—á–µ—Ä–µ–¥—è–º–∏ –∏–ª–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏, —Ç–æ —É–∂–µ —Å—Ç–∞–ª–∫–∏–≤–∞–ª–∏—Å—å —Å middleware, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ –Ω–∞–∑—ã–≤–∞–ª–∏ –µ–≥–æ —Ç–∞–∫.

**–ü—Ä–∏–º–µ—Ä:**
```
–ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å ‚Üí Middleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω ‚Üí –õ–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Üí –û—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É
```

### –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ —Å–µ–Ω—å–æ—Ä—É?
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**
- **–£–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–¥–∞**
- **–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏**

## 2. –ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω Middleware?
Middleware ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –∏–ª–∏ –Ω–∞–±–æ—Ä —Ñ—É–Ω–∫—Ü–∏–π, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ. –û–±—ã—á–Ω–æ —ç—Ç–æ **—Ü–µ–ø–æ—á–∫–∞ (pipeline)**, –≥–¥–µ –∫–∞–∂–¥—ã–π —à–∞–≥ –¥–µ–ª–∞–µ—Ç —Å–≤–æ—é —Ä–∞–±–æ—Ç—É –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–ª—å—à–µ.

### –ö–ª—é—á–µ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞:
- **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —à–∞–≥ –∑–∞ —à–∞–≥–æ–º.
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç**: –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –∑–∞–ø—Ä–æ—Å–∞/–æ—Ç–≤–µ—Ç–∞.
- **–ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ**: –º–æ–∂–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ü–µ–ø–æ—á–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞).

#### –ü—Ä–∏–º–µ—Ä –∏–∑ –∂–∏–∑–Ω–∏:
–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ **–∫–æ–Ω–≤–µ–π–µ—Ä** –Ω–∞ –∑–∞–≤–æ–¥–µ. –ó–∞–ø—Ä–æ—Å ‚Äî —ç—Ç–æ –¥–µ—Ç–∞–ª—å, –∞ middleware ‚Äî —Å—Ç–∞–Ω–∫–∏: –æ–¥–∏–Ω –∫—Ä–∞—Å–∏—Ç, –¥—Ä—É–≥–æ–π —Å–≤–µ—Ä–ª–∏—Ç, —Ç—Ä–µ—Ç–∏–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å, –¥–µ—Ç–∞–ª—å –¥–∞–ª—å—à–µ –Ω–µ –∏–¥—ë—Ç.

## 3. –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Middleware?

| –°–∏—Å—Ç–µ–º–∞          | –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è                     |
|-----------------|----------------------------------|
| **–í–µ–±-—Å–µ—Ä–≤–µ—Ä—ã** | Express (Node.js), ASP.NET Core, Django  |
| **API-—à–ª—é–∑—ã**   | Kong, Apigee  |
| **–û—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π** | RabbitMQ, Kafka  |
| **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã** | Istio, Linkerd  |

### –°–µ–Ω—å–æ—Ä—Å–∫–∏–π –≤–∑–≥–ª—è–¥
Middleware –ø–æ–∑–≤–æ–ª—è–µ—Ç **–≤—ã–Ω–µ—Å—Ç–∏ —Å–∫–≤–æ–∑–Ω—É—é –ª–æ–≥–∏–∫—É** (cross-cutting concerns) –∏–∑ –±–∏–∑–Ω–µ—Å-–∫–æ–¥–∞, –æ—Å—Ç–∞–≤–ª—è—è –µ–≥–æ —á–∏—Å—Ç—ã–º.

## 4. –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ (–Ω–∞ Go)

–î–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å HTTP-—Å–µ—Ä–≤–µ—Ä. –ú—ã —Ö–æ—Ç–∏–º –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π.

```go
package main

import (
	"fmt"
	"log"
	"net/http"
)

// Middleware-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
func loggingMiddleware(next http.Handler) http.Handler {
	return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
		log.Printf("–ó–∞–ø—Ä–æ—Å: %s %s", r.Method, r.URL.Path)
		next.ServeHTTP(w, r) // –ü–µ—Ä–µ–¥–∞—ë–º –¥–∞–ª—å—à–µ
	})
}

// Middleware-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞
func authMiddleware(next http.Handler) http.Handler {
	return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
		token := r.Header.Get("Authorization")
		if token != "secret-token" {
			http.Error(w, "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞", http.StatusUnauthorized)
			return // –ü—Ä–µ—Ä—ã–≤–∞–µ–º —Ü–µ–ø–æ—á–∫—É
		}
		next.ServeHTTP(w, r) // –¢–æ–∫–µ–Ω –æ–∫, –∏–¥—ë–º –¥–∞–ª—å—à–µ
	})
}

// –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
func handler(w http.ResponseWriter, r *http.Request) {
	fmt.Fprintf(w, "–ü—Ä–∏–≤–µ—Ç, —Ç—ã –ø—Ä–æ—à—ë–ª –ø—Ä–æ–≤–µ—Ä–∫—É!")
}

func main() {
	mux := http.NewServeMux()
	mux.HandleFunc("/", handler)

	// –°–æ–±–∏—Ä–∞–µ–º —Ü–µ–ø–æ—á–∫—É middleware
	finalHandler := loggingMiddleware(authMiddleware(mux))

	log.Fatal(http.ListenAndServe(":8080", finalHandler))
}
```

### –ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?
1. `loggingMiddleware` ‚Äî –ª–æ–≥–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å.
2. `authMiddleware` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω. –ï—Å–ª–∏ –æ–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401 –∏ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç —Ü–µ–ø–æ—á–∫—É.
3. –ï—Å–ª–∏ –≤—Å—ë –æ–∫, –∑–∞–ø—Ä–æ—Å –¥–æ—Ö–æ–¥–∏—Ç –¥–æ `handler`.

## 5. –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è —Å–µ–Ω—å–æ—Ä–æ–≤?

### **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**
–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –æ—Ç–¥–µ–ª—å–Ω–æ, —Å–∫–≤–æ–∑–Ω–∞—è –ª–æ–≥–∏–∫–∞ (–ª–æ–≥–∏, –º–µ—Ç—Ä–∏–∫–∏, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è) ‚Äî –≤ middleware.

### **–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**
–ù–∞–ø–∏—Å–∞–ª–∏ middleware –¥–ª—è –ª–æ–≥–æ–≤? –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –≤–µ–∑–¥–µ.

### **–ì–∏–±–∫–æ—Å—Ç—å**
–•–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Å–∂–∞—Ç–∏–µ –æ—Ç–≤–µ—Ç–æ–≤? –ü—Ä–æ—Å—Ç–æ –ø–∏—à–µ—Ç–µ –Ω–æ–≤—ã–π middleware, –Ω–µ —Ç—Ä–æ–≥–∞—è —Å—Ç–∞—Ä—ã–π –∫–æ–¥.

### **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞**
Middleware ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

## 6. –¢–∏–ø–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏ Middleware
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤, —Ä–æ–ª–µ–π.
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ó–∞–ø–∏—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤, –æ—à–∏–±–æ–∫.
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –ü–µ—Ä–µ—Ö–≤–∞—Ç –ø–∞–Ω–∏–∫, –≤–æ–∑–≤—Ä–∞—Ç 500 –≤–º–µ—Å—Ç–æ –∫—Ä–∞—à–∞.
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤.
- **Rate limiting**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∏—Å–ª–∞ –∑–∞–ø—Ä–æ—Å–æ–≤.
- **–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: –ù–∞–ø—Ä–∏–º–µ—Ä, —Å–∂–∞—Ç–∏–µ JSON –≤ Gzip.

## 7. –ü—Ä–æ–±–ª–µ–º—ã –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| **–ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: –µ—Å–ª–∏ –ª–æ–≥–∏ –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –Ω–µ—É—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –∑–∞–ª–æ–≥–∏—Ä—É—é—Ç—Å—è. | –õ–æ–≥–∏ –∏–¥—É—Ç –ø–µ—Ä–≤—ã–º–∏, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ‚Äî —Å–ª–µ–¥–æ–º. |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ middleware –∑–∞–º–µ–¥–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã. | –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ, —É–±–∏—Ä–∞–π—Ç–µ –ª–∏—à–Ω–µ–µ, –ø—Ä–æ—Ñ–∏–ª–∏—Ä—É–π—Ç–µ. |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏**: –æ—à–∏–±–∫–∞ –≥–¥–µ-—Ç–æ –≤ —Ü–µ–ø–æ—á–∫–µ. | –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏ –∏–ª–∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É (OpenTelemetry). |

### –°–µ–Ω—å–æ—Ä—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥
–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ **–∫–∞–∂–¥—ã–π middleware –æ—Ç–¥–µ–ª—å–Ω–æ**, —á—Ç–æ–±—ã —Ü–µ–ø–æ—á–∫–∞ –Ω–µ —Å—Ç–∞–ª–∞ "—á—ë—Ä–Ω—ã–º —è—â–∏–∫–æ–º".

## 8. –†–µ–∞–ª—å–Ω—ã–π –∫–µ–π—Å

–î–æ–ø—É—Å—Ç–∏–º, –≤–∞–º –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å API –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞. Middleware –º–æ–∂–µ—Ç:

- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã (`GET /products`).
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å JWT-—Ç–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ `/orders`.
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –≤ `/products/popular`.
- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ `/checkout` –¥–æ 10 –≤ –º–∏–Ω—É—Ç—É –Ω–∞ IP.

–° —Ç–∞–∫–æ–π —Ü–µ–ø–æ—á–∫–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–π: **"–≤–µ—Ä–Ω–∏ —Ç–æ–≤–∞—Ä—ã", "—Å–æ–∑–¥–∞–π –∑–∞–∫–∞–∑"**. –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –≤ middleware.

## 9. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**Middleware** ‚Äî —ç—Ç–æ –≤–∞—à –ª—É—á—à–∏–π –¥—Ä—É–≥ –¥–ª—è **–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–≥–æ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–≥–æ –∫–æ–¥–∞**. –û–Ω–æ –±–µ—Ä—ë—Ç –Ω–∞ —Å–µ–±—è —Ä—É—Ç–∏–Ω—É, –æ—Å—Ç–∞–≤–ª—è—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É —á–∏—Å—Ç–æ–π –∏ –ø–æ–Ω—è—Ç–Ω–æ–π.

### **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ?**
‚úÖ –ù–µ –ø–µ—Ä–µ–±–∞—Ä—â–∏–≤–∞–π—Ç–µ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–ª–æ—ë–≤.
‚úÖ –î–µ—Ä–∂–∏—Ç–µ –ø–æ—Ä—è–¥–æ–∫ –≤ —Ü–µ–ø–æ—á–∫–µ.
‚úÖ –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ middleware –æ—Ç–¥–µ–ª—å–Ω–æ.

### –í–æ–ø—Ä–æ—Å –∫ –≤–∞–º
–ö–∞–∫ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ middleware –≤ —Å–≤–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö? –ï—Å—Ç—å –ª–∞–π—Ñ—Ö–∞–∫–∏ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∫–µ–π—Å–æ–≤? –î–µ–ª–∏—Ç–µ—Å—å!

–ï—Å–ª–∏ –Ω—É–∂–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –Ω–∞ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö (Node.js, Python) –∏–ª–∏ **–≥–ª—É–±–æ–∫–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ –≤ –∫–∞–∫–æ–π-—Ç–æ –∞—Å–ø–µ–∫—Ç** ‚Äî —Å–∫–∞–∂–∏—Ç–µ, –¥–æ–±–∞–≤–ª—é! üòä

