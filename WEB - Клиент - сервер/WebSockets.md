# WebSockets

## –í–≤–µ–¥–µ–Ω–∏–µ
–ü—Ä–∏–≤–µ—Ç! –°–µ–≥–æ–¥–Ω—è –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º –ø—Ä–æ **WebSockets** ‚Äì —Å—É–ø–µ—Ä–±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± –æ–±—â–µ–Ω–∏—è –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º. –≠—Ç–æ –∫–∞–∫ –≤–æ–ª—à–µ–±–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π –≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ —Å–≤—è–∑–∏, –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–∏—Å—å–º–∞ (HTTP-–∑–∞–ø—Ä–æ—Å—ã).

---

## –ß—Ç–æ —Ç–∞–∫–æ–µ WebSockets –∏ –∑–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–Ω—ã?
–û–±—ã—á–Ω—ã–µ HTTP-–∑–∞–ø—Ä–æ—Å—ã ‚Äì —ç—Ç–æ –∫–∞–∫ –ø–∏—Å—å–º–∞: –±—Ä–∞—É–∑–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å üìú, —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç ‚úâÔ∏è, –∏ –Ω–∞ —ç—Ç–æ–º –≤—Å—ë. –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, –±—Ä–∞—É–∑–µ—Ä –¥–æ–ª–∂–µ–Ω —Å–Ω–æ–≤–∞ —Å–ø—Ä–æ—Å–∏—Ç—å. –ê WebSockets ‚Äì —ç—Ç–æ –∫–∞–∫ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–∞—è –ª–∏–Ω–∏—è üìû: —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ, –∏ —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç —Å–∞–º –ø—Ä–∏—Å—ã–ª–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ!

### –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è WebSockets?
- üî• **–ß–∞—Ç—ã –∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã** (WhatsApp, Telegram Web)
- üéÆ **–û–Ω–ª–∞–π–Ω-–∏–≥—Ä—ã** (Counter-Strike, Fortnite)
- üìà **–¢–æ—Ä–≥–æ–≤—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã** (–±–∏—Ä–∂–∏, –∫–æ—Ç–∏—Ä–æ–≤–∫–∏ –∞–∫—Ü–∏–π)
- üîÑ **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, live-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –ø–æ—Ç–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ)
- üöó **–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –≤–µ—â–µ–π (IoT)** (—É–º–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –¥–∞—Ç—á–∏–∫–∏)

---

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç WebSockets?
WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Ç—Ä–∏ —ç—Ç–∞–ø–∞:
1. üìû **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è** (Handshake) ‚Äì –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å —Å `Upgrade: websocket`, —Å–µ—Ä–≤–µ—Ä –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç.
2. üîÑ **–î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏** ‚Äì —Å–µ—Ä–≤–µ—Ä –∏ –∫–ª–∏–µ–Ω—Ç –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è.
3. üîö **–ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è** ‚Äì –µ—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ, –µ–≥–æ –º–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å.

### HTTP vs WebSockets
| –§—É–Ω–∫—Ü–∏—è            | HTTP              | WebSockets        |
|-------------------|-----------------|-----------------|
| –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ       | –ù–æ–≤–æ–µ –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å | –û–¥–Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ |
| –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö | –¢–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç ‚Üí —Å–µ—Ä–≤–µ—Ä | –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π |
| –°–∫–æ—Ä–æ—Å—Ç—å        | –ú–µ–¥–ª–µ–Ω–Ω—ã–π (–º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤) | –ë—ã—Å—Ç—Ä—ã–π (–º–µ–Ω—å—à–µ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤) |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ   | API-–∑–∞–ø—Ä–æ—Å—ã, –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü | –ß–∞—Ç—ã, –∏–≥—Ä—ã, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ |

---

## WebSocket Handshake (–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è)
–í—Å–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –æ–±—ã—á–Ω–æ–≥–æ HTTP-–∑–∞–ø—Ä–æ—Å–∞, –Ω–æ —Å –Ω–µ–±–æ–ª—å—à–∏–º —Ç—Ä—é–∫–æ–º:
```http
GET /chat HTTP/1.1
Host: example.com
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
Sec-WebSocket-Version: 13
```

–°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç:
```http
HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=
```
–¢–µ–ø–µ—Ä—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –∏ –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ–∑ –ª–∏—à–Ω–∏—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤! üöÄ

---

## –ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å WebSockets –≤ Go
–í Go –µ—Å—Ç—å –∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `github.com/gorilla/websocket`. –î–∞–≤–∞–π —Å–æ–∑–¥–∞–¥–∏–º –ø—Ä–æ—Å—Ç–æ–π WebSocket-—Å–µ—Ä–≤–µ—Ä!

### 1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É
```sh
go get -u github.com/gorilla/websocket
```

### 2. –ü–∏—à–µ–º —Å–µ—Ä–≤–µ—Ä
```go
package main

import (
	"fmt"
	"net/http"
	"github.com/gorilla/websocket"
)

var upgrader = websocket.Upgrader{
	CheckOrigin: func(r *http.Request) bool {
		return true
	},
}

func handleConnection(w http.ResponseWriter, r *http.Request) {
	conn, err := upgrader.Upgrade(w, r, nil)
	if err != nil {
		fmt.Println("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:", err)
		return
	}
	defer conn.Close()

	for {
		messageType, msg, err := conn.ReadMessage()
		if err != nil {
			fmt.Println("–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:", err)
			break
		}
		fmt.Println("–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ:", string(msg))
		conn.WriteMessage(messageType, msg) // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ (echo)
	}
}

func main() {
	http.HandleFunc("/ws", handleConnection)
	fmt.Println("–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ :8080")
	http.ListenAndServe(":8080", nil)
}
```

–¢–µ–ø–µ—Ä—å, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å `ws://localhost:8080/ws` –≤ WebSocket-–∫–ª–∏–µ–Ω—Ç–µ, –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∏ –ø–æ–ª—É—á–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è!

---

## WebSocket-–∫–ª–∏–µ–Ω—Ç (JavaScript)
```js
const socket = new WebSocket("ws://localhost:8080/ws");

socket.onopen = () => {
    console.log("–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!");
    socket.send("–ü—Ä–∏–≤–µ—Ç, —Å–µ—Ä–≤–µ—Ä!");
};

socket.onmessage = (event) => {
    console.log("–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ:", event.data);
};

socket.onclose = () => {
    console.log("–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ");
};
```
–¢–µ–ø–µ—Ä—å –±—Ä–∞—É–∑–µ—Ä –∏ —Å–µ—Ä–≤–µ—Ä –º–æ–≥—É—Ç –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏! üöÄ

---

## –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ WebSockets
–í —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö WebSockets –º–æ–≥—É—Ç –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å —Ç—ã—Å—è—á–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π. –ö–∞–∫ —Å —ç—Ç–∏–º —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è?

- **Goroutines** ‚Äì Go –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã—Ö WebSockets!
- **Redis Pub/Sub** ‚Äì –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏.
- **Load Balancers (NGINX, HAProxy)** ‚Äì –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏.
- **Kafka –∏–ª–∏ RabbitMQ** ‚Äì –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å WebSockets
WebSockets –±—ã—Å—Ç—Ä—ã–µ, –Ω–æ —Ç—Ä–µ–±—É—é—Ç –∑–∞—â–∏—Ç—ã:
- **HTTPS + WSS** ‚Äì —à–∏—Ñ—Ä—É–µ–º —Ç—Ä–∞—Ñ–∏–∫.
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (JWT, —Ç–æ–∫–µ–Ω—ã)** ‚Äì –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
- **Rate Limiting** ‚Äì –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤.
- **CORS** ‚Äì —Ä–∞–∑—Ä–µ—à–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã —Ç–æ–ª—å–∫–æ –æ—Ç –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤.

–ü—Ä–∏–º–µ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Ç–æ–∫–µ–Ω–æ–º:
```go
http.HandleFunc("/ws", func(w http.ResponseWriter, r *http.Request) {
	token := r.Header.Get("Authorization")
	if !validateToken(token) {
		http.Error(w, "Unauthorized", http.StatusUnauthorized)
		return
	}
	handleConnection(w, r)
})
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
WebSockets ‚Äì —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—ã—Å—Ç—Ä—ã–º–∏, –æ—Ç–∑—ã–≤—á–∏–≤—ã–º–∏ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–º–∏.
