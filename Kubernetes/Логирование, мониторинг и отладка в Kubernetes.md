# Логирование, мониторинг и отладка в Kubernetes

Когда у тебя есть приложение в Kubernetes, ты хочешь знать, что с ним происходит: работает ли оно нормально, нет ли ошибок, и что делать, если что-то сломалось. Для этого нужны три вещи:

- **Мониторинг** — следить за состоянием (например, сколько ресурсов тратит приложение).
- **Логирование** — собирать "дневники" работы приложения (что оно делает и где ошибка).
- **Отладка** — инструменты, чтобы "залезть" внутрь и починить проблему.

Давай разберём, как это работает в Kubernetes.

## Prometheus + Grafana

### Что это такое?
Prometheus и Grafana — это пара лучших друзей для слежки за твоими приложениями.

- **Prometheus**: это как "шпион", который собирает информацию о том, что происходит в Kubernetes. Например, сколько процессора занято, сколько памяти используется, или сколько запросов приходит к сайту.
- **Grafana**: это как "художник", который превращает данные от Prometheus в красивые графики и dashboards (панели управления), чтобы ты мог всё легко увидеть.

### Как работает?
1. Prometheus ходит по твоему кластеру и записывает метрики (числа, показывающие состояние системы).
2. Grafana берёт эти числа и рисует их в виде линий, столбиков или кругов на экране.

### Пример
У тебя есть сайт. Prometheus следит, сколько людей заходит на него каждую минуту. Grafana показывает это на графике: если линия резко идёт вверх, значит, посетителей стало больше. Если сайт "упал", ты сразу видишь, что что-то не так.

### Зачем нужно?
Чтобы быстро понять, всё ли в порядке с твоим приложением, и заметить проблемы до того, как пользователи начнут жаловаться.

## Loki + Fluentd

### Что это такое?
Loki и Fluentd — это команда для работы с логами (записями о том, что делает приложение).

- **Fluentd**: это как "почтальон", который собирает все "письма" (логи) от твоих контейнеров и отправляет их в одно место.
- **Loki**: это как "библиотека", где все эти письма хранятся и где ты можешь их легко найти и прочитать.

### Как работает?
1. Каждый контейнер в Kubernetes пишет свои логи (например, "Пользователь вошёл", "Ошибка 404").
2. Fluentd собирает эти записи со всех контейнеров.
3. Loki сохраняет их и даёт тебе поиск, чтобы найти нужное (например, все ошибки за последние 5 минут).

### Пример
Твой интернет-магазин работает, но кто-то жалуется, что не может купить товар. Ты открываешь Loki, ищешь слово "ошибка" и видишь: "Нет соединения с базой данных". Теперь ты знаешь, где копать дальше.

### Зачем нужно?
Чтобы видеть, что происходит внутри приложения, и быстро находить причины проблем.

## Debugging tools (инструменты для отладки)

Если что-то сломалось, тебе нужно "залезть" в приложение и понять, что не так. Kubernetes даёт три простых инструмента:

### 1. kubectl logs
#### Что это?
Команда, которая показывает "дневник" работы контейнера — его логи.

#### Как работает?
Ты пишешь в терминале:
```sh
kubectl logs <имя-контейнера>
```
И видишь всё, что контейнер "сказал" за последнее время.

#### Пример
Твой сайт выдаёт ошибку. Ты запускаешь `kubectl logs web-1` и видишь: "Не могу найти файл config". Значит, проблема в настройках.

#### Зачем нужно?
Чтобы быстро узнать, что происходит внутри контейнера.

### 2. kubectl exec
#### Что это?
Команда, которая позволяет "зайти" внутрь контейнера и запустить там команды, как будто ты сидишь за его компьютером.

#### Как работает?
Ты пишешь:
```sh
kubectl exec -it <имя-контейнера> -- bash
```
И попадаешь в командную строку контейнера. Там можно посмотреть файлы, проверить настройки и т.д.

#### Пример
Ты подозреваешь, что в контейнере пропал важный файл. Заходишь через `kubectl exec`, пишешь `ls` (или `dir`, если Windows), и видишь, что файла действительно нет.

#### Зачем нужно?
Чтобы вручную проверить или исправить что-то внутри контейнера.

### 3. kubectl port-forward
#### Что это?
Команда, которая "пробрасывает" порт из контейнера на твой компьютер, чтобы ты мог подключиться к нему напрямую.

#### Как работает?
Ты пишешь:
```sh
kubectl port-forward <имя-контейнера> 8080:80
```
Теперь ты можешь открыть браузер на своём компьютере и зайти на `localhost:8080`, чтобы увидеть, что показывает контейнер.

#### Пример
Твой веб-сервер работает в контейнере, но ты хочешь проверить, что он выдаёт. Делаешь port-forward, открываешь `localhost:8080` и видишь страницу сайта или ошибку.

#### Зачем нужно?
Чтобы протестировать приложение, не трогая внешний доступ.

## Итог
Представь, что твой кластер — это большой дом:

- **Prometheus + Grafana**: камеры и экран, чтобы следить за всем домом (мониторинг).
- **Loki + Fluentd**: дневник, где записано, кто что делал в доме (логирование).
- **kubectl logs, exec, port-forward**: инструменты, чтобы зайти в комнаты и починить сломанный кран (отладка).

Вместе они помогают тебе:

1. Знать, что всё работает нормально.
2. Быстро находить и чинить проблемы.
