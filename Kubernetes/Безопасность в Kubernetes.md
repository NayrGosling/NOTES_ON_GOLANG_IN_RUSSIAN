# Безопасность в Kubernetes

Когда у тебя есть приложение в Kubernetes, ты хочешь, чтобы оно было защищено от чужих рук и случайных ошибок. Например, чтобы никто не украл пароли или чтобы один контейнер не сломал другой. Kubernetes даёт несколько инструментов, чтобы сделать систему безопасной. Давай разберём их по порядку.

## RBAC (Role-Based Access Control)

### Что это такое?
RBAC — это как "список правил", который решает, кто что может делать в твоём кластере Kubernetes. Это сокращение от "управление доступом на основе ролей".

### Как работает?
Ты создаёшь роли (например, "админ", "разработчик", "гость") и говоришь:

- "Админ может всё".
- "Разработчик может запускать приложения, но не удалять серверы".
- "Гость может только смотреть".

Потом ты привязываешь эти роли к людям или сервисам.

### Пример
У тебя есть кластер, где работает сайт. Ты настраиваешь RBAC так:

- Твой коллега Вася (разработчик) может обновлять сайт, но не трогать базу данных.
- Аня (админ) может делать вообще всё.
- Бот для мониторинга может только читать данные, но ничего менять.

Если кто-то попытается сделать то, что ему не разрешено, Kubernetes скажет: "Нет доступа!"

### Зачем нужно?
Чтобы каждый делал только свою работу и никто случайно (или специально) не сломал систему.

---

## Pod Security Standards

### Что это такое?
Pod Security Standards — это как "правила поведения" для контейнеров (Pods) в Kubernetes. Они говорят, насколько строго ограничивать контейнеры, чтобы они не делали опасных вещей.

### Какие бывают?
Есть три уровня:

- **Restricted (строгий)**: контейнер почти ничего не может — ни запускать опасные команды, ни получать лишние права.
- **Baseline (средний)**: контейнеру чуть больше свободы, но всё равно много ограничений.
- **Privileged (свободный)**: контейнер может почти всё.

### Как работает?
Ты выбираешь уровень и применяешь его к своим контейнерам. Kubernetes следит, чтобы они соблюдали правила.

### Пример
У тебя есть сайт и база данных:

- Сайт работает в режиме **Baseline** — ему не нужны лишние права, он просто показывает странички.
- База данных в режиме **Privileged** — ей нужно больше свободы, чтобы сохранять данные.

Если кто-то попытается запустить контейнер с опасными настройками в **Restricted**, Kubernetes его остановит.

### Зачем нужно?
Чтобы контейнеры не могли навредить системе или друг другу.

---

## Secrets и ConfigMaps

### Что это такое?
Secrets и ConfigMaps — это как "сейфы" и "папки" для хранения важной информации.

- **Secrets**: для секретных данных, например, паролей, ключей или токенов.
- **ConfigMaps**: для обычных настроек, например, адреса сервера или имени базы данных.

### Как работает?
Ты создаёшь Secret или ConfigMap, записываешь туда данные, а потом говоришь контейнеру: "Возьми оттуда, что нужно". Контейнеры не хранят эту информацию внутри себя — всё лежит отдельно.

### Пример
У тебя есть приложение:

- В **Secret** ты кладешь пароль от базы данных: `mysecretpass`.
- В **ConfigMap** — адрес базы: `database.example.com`.

Приложение запускается, берёт пароль и адрес из этих "сейфов" и подключается к базе. Если кто-то украдёт код приложения, он не увидит пароль, потому что он спрятан в **Secret**.

### Зачем нужно?
Чтобы важные данные были в безопасности и чтобы их можно было легко менять без переписывания кода.

---

## Network Policies и PSP (Pod Security Policies)

### Что это такое?
Эти инструменты защищают сеть и контейнеры от лишних действий.

- **Network Policies**: это как "правила дорожного движения" для сети. Они решают, какие контейнеры могут общаться друг с другом.
- **PSP (Pod Security Policies)**: это старый способ ограничивать права контейнеров (похоже на Pod Security Standards, но сложнее). Сейчас его редко используют, но он всё ещё есть.

### Как работает?
- **Network Policies**: ты пишешь правила, например: "Веб-сервер может говорить с базой данных, но не с другими сервисами".
- **PSP**: ты задаёшь, что контейнеру нельзя делать, например, запускать команды от имени администратора.

### Пример
У тебя есть три контейнера: сайт, база данных и бот.

- С помощью **Network Policies** ты разрешаешь сайту общаться только с базой, а бот вообще ни с кем не соединяется.
- С помощью **PSP** ты запрещаешь боту получать права администратора, чтобы он не мог случайно сломать кластер.

Если кто-то попробует нарушить правила, Kubernetes заблокирует это.

### Зачем нужно?
Чтобы ограничить "разговоры" между контейнерами и не дать им слишком много свободы.

---

## Итог

Представь свой кластер как дом:

- **RBAC**: это как ключи от комнат — у каждого свои, и никто не лезет туда, куда нельзя.
- **Pod Security Standards**: это замки на дверях, чтобы жильцы вели себя прилично.
- **Secrets и ConfigMaps**: это сейф для паролей и записная книжка для настроек.
- **Network Policies и PSP**: это заборы и правила, чтобы жильцы не мешали друг другу.

### Вместе они делают твой кластер безопасным:

✅ Никто лишний не получит доступ.

✅ Контейнеры не смогут навредить.

✅ Важные данные спрятаны.

